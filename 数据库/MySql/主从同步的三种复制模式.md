# MySQL 主从同步的三种复制模式详解

MySQL 支持三种主从复制模式，分别是：

---

## 1. 基于语句复制（Statement-based Replication, SBR）

- **原理**：主库将执行的 SQL 语句写入 binlog，从库直接执行这些 SQL 语句。  
- **优点**：  
  - 日志体积较小，网络传输压力较低。  
  - 便于日志审计和调试。  
- **缺点**：  
  - 某些语句存在非确定性（如 `NOW()`, `UUID()`, `RAND()` 等），可能导致主从数据不一致。  
  - 不支持某些复杂语句的精确复制。  
- **适用场景**：对数据一致性要求不高，且 SQL 语句相对简单的场景。

---

## 2. 基于行复制（Row-based Replication, RBR）

- **原理**：主库将数据变更的**具体行数据**（行事件）写入 binlog，从库直接根据这些行数据更新本地数据。  
- **优点**：  
  - 复制更精确，避免了语句级别的非确定性问题。  
  - 保证主从数据一致性较高。  
- **缺点**：  
  - 日志量较大，网络带宽和存储压力增大。  
  - 日志内容不易阅读，调试相对复杂。  
- **适用场景**：对数据一致性要求高，复杂 SQL 语句较多的生产环境。

---

## 3. 混合模式复制（Mixed Replication, MBR）

- **原理**：MySQL 根据 SQL 语句的特性自动选择使用基于语句复制还是基于行复制。  
- **特点**：  
  - 优先使用基于语句复制，遇到非确定性或复杂语句自动切换为基于行复制。  
  - 兼顾了日志大小和数据一致性的平衡。  
- **适用场景**：大多数应用场景的默认选择，兼顾效率与一致性。

---

## 复制模式切换配置

- 配置参数：`binlog_format`  
  - `STATEMENT`：基于语句复制  
  - `ROW`：基于行复制  
  - `MIXED`：混合模式复制（默认）

```sql
-- 查看当前复制格式
SHOW VARIABLES LIKE 'binlog_format';

-- 修改复制格式（动态生效）
SET GLOBAL binlog_format = 'ROW';
